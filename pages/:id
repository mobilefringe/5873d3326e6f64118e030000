<div class="page_body">
    <h1 class="page_title" id="page_title"></h1>
    <hr>
    <div id="contact_us" class="hidden_now">
        <div id="map_container">
            <script id="map_template" type="x-tmpl-mustache/text">
                <iframe class="hidden-xs" src="https://maps.google.com/maps?q={{address1}} {{city}} {{Country}} {{province_state}} {{postal_code}}&amp;hl=en&amp;ie=UTF8&amp;t=v&amp;hnear={{name}} {{address1}} {{city}} {{Country}} {{province_state}} {{postal_code}}&amp;z=13&amp;output=embed" width="100%" height="405" frameborder="0" style="border:0" allowfullscreen></iframe> 
                <iframe class="visible-xs-inline-block" src="https://maps.google.nl/maps?q={{name}} {{address1}} {{city}} {{Country}} {{province_state}} {{postal_code}}&amp;hl=en&amp;ie=UTF8&amp;t=v&amp;hnear={{name}} {{address1}} {{city}} {{Country}} {{province_state}} {{postal_code}}&amp;z=13&amp;output=embed" width="100%" height="300" frameborder="0" style="border:0" allowfullscreen></iframe>
                <div class="line_break"></div>
            </script>
        </div>  
    </div>
    <div id="page_body"></div>
    <div id="contact_form" class="hidden_now">
        <form id="msg-contact" accept-charset="UTF-8" action="http://mobilefringe.createsend.com/t/d/s/tuktjk/"  enctype="multipart/form-data"  method="post">
            <input id="cm-name" type="hidden" name="cm-name" />
            <div class="row">
                <div class="col-md-6">
                    <label for="cm-firstname">First Name*</label>
                   <input class="contact-inputs" id="cm-firstname" name="cm-firstname" type="text" required/>
                </div>
                <div class="col-md-6">                
                   <label for="cm-lastname">Last Name*</label>
                    <input class="contact-inputs" id="cm-lastname" name="cm-lastname" type="text" required/>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <label for="email-newsletter">Email*</label>
                    <input class="contact-inputs" id="email-newsletter" name="cm-tuktjk-tuktjk" type="email" required />
                </div>
                <div class="col-md-6">
                   <label for="phoneNumber">Phone Number*</label>
                   <input class="contact-inputs" id="phoneNumber" name="cm-f-jyjkht" type="text" required/>
                </div>
            </div>
            <div class="row">
                <div class="col-md-10">
                    <label for="message">Message*</label>
                    <textarea id="message" name="cm-f-jyjkhi"></textarea>
                </div>
            </div>
            <div class="row">
                <div class="col-md-10">
                    <div class="g-recaptcha" data-sitekey="6LduhgITAAAAAOuswnYWavEr1XmVyd-L4iAz-ElA"></div>
                    <div id="captcha_validation" style="color:red; margin-top:10px; margin-bottom:10px; font-weight:bold; display:none">
                       Captcha is not valid!
                    </div>     
                </div>
            </div>
            <div class="row">
                <div class="col-md-10">
                    <input class="btn btn-success " name="commit" onclick="submitMSG()" value="Submit" style="width:355px; height: 55px;" />      
                </div>
            </div>
            <div class="line_break"></div>
            <!-- Captcha END -->
        </form>
    </div>
</div>
<div class="mobile_line_break"></div>

<script>
    $(document).ready(function(){
        function renderAll(){
            init();
            var prop_details = getPropertyDetails();
            console.log(prop_details);
            renderPropertyDetails('#map_container', '#map_template', prop_details);
            
            var pathArray = window.location.pathname.split( '/' );
            var slug = pathArray[pathArray.length-1];
            var pages_json = "//www.westbrookmall.com//pages/" + slug + ".json"
            $.getJSON(pages_json).done(function(data) {
                $('#page_title').html(data.title);
                $('#page_body').html(data.body);
                if(slug === "westbrook-contact-us") {
                    $("#contact_us").show();
                    $("#contact_form").show();
                }
                if(slug === "westbrook-accessability") {
                    $("#page_title").html("Accessibility");
                }
            }).fail(function(jqXHR) {
                if (jqXHR.status == 404) {
                    $("#error_msg").fadeIn("fast");
                }
            }); 
        }
        
        function submitMSG(){
            if ($("#cm-firstname").val() == ""){
                alert("Please Enter First Name");
                $("#cm-firstname").focus();
                return false;
            } else if ($("#cm-lastname").val() == ""){
                alert("Please Enter Last Name");
                $("#cm-lastname").focus();
                return false;
            } else if ($("#email-newsletter").val() == ""){
                alert("Please Enter Email");
                $("#email-newsletter").focus();
                return false;
            } else if(!isValidEmailAddress($("#email-newsletter").val())){
                alert("Please Enter a valid email address");
                $("#email-newsletter").focus();
                return false;
            } else if ($("#phoneNumber").val() == ""){
                alert("Please Enter Phone Number");
                $("#phoneNumber").focus();
                return false;
            } else if ($("#message").val() == ""){
                alert("Please Enter message");
                $("#message").focus();
                return false;
            }

            $('#cm-name').val($('#cm-firstname').val()+ ' ' +$('#cm-lastname').val());
            var values = {};
             $.each($('#msg-contact').serializeArray(), function(i, field) {
                 values[field.name] = field.value;
             });
            
            $.ajax({
                url : "/verify_captcha",
                type: "POST",
                data : {
                    "g-recaptcha-response": values['g-recaptcha-response'],
                    "secret_key": "6LduhgITAAAAANNWQjvEjqsi_cC0CrfNaqsg7e3u"
                },
                success: function(data, textStatus, jqXHR)
                {
                    if(data == "true"){
                        $.post( "/send_contact_email", { 'send_to': "westbrookmallinfo@20vic.com", 'subject': "Customer Feedback - Westbrook Mall", 'body': {"Name": $('#cm-name').val(), "Email" : $('#email-newsletter').val(), "Phone Number":$('#phoneNumber').val(),"Message":$('#message').val()} } );
                        $("#msg-contact").submit();
                    } else{
                        $('#captcha_validation').show();
                    }
                  
                },
                error: function (jqXHR, textStatus, errorThrown)
                {
                }
            });
        }
        loadMallDataCached(renderAll); 
    })
</script>