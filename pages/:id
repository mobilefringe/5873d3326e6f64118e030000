<style>
    #error_msg {
        text-align: center;
    }
    label {
        margin-top: 15px;
        display: block;
    }
    .contact-inputs, textarea {
        margin-bottom: 9px;
        padding: 4px 6px;
        width: 80%; 
        height: 40px;
        background-color: #ffffff;
        border: 1px solid #cccccc;
        border-radius: 3px;
        box-shadow: inset 0 1px 1px rgba(0,0,0,0.075);
        transition: border linear 0.2s, box-shadow linear 0.2s;
        font-size: 14px;
        line-height: 20px;
        color: #555555;
    }

    textarea{
        margin-bottom:20px;
        width: 80%; 
        height:200px; 
        resize:none;
    }
    .btn-sucess {
        color: #ffffff;
        text-shadow: 0 -1px 0 rgba(0,0,0,0.25);
        background-color: #5bb75b;
        background-repeat: repeat-x;
        border-color: #51a351 #51a351 #387038;
        border-color: rgba(0,0,0,0.1) rgba(0,0,0,0.1) rgba(0,0,0,0.25);
    }
    .g-recaptcha{
        margin-bottom: 20px;
    }
</style>
<div class="page_body">
    <h1 class="page_title" id="page_title"></h1>
    <hr>
    <div id="contact_us" class="hidden_now">
        <iframe class="hidden-xs" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2508.6113053338036!2d-114.14118088433742!3d51.04179935245954!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x53716e309b084c4f%3A0x4bf73618e4160580!2sWestbrook+Mall!5e0!3m2!1sen!2sca!4v1483996195167" width="100%" height="405" frameborder="0" style="border:0" allowfullscreen></iframe>
        
        <iframe class="visible-xs-inline-block" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2508.6113053338036!2d-114.14118088433742!3d51.04179935245954!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x53716e309b084c4f%3A0x4bf73618e4160580!2sWestbrook+Mall!5e0!3m2!1sen!2sca!4v1483996195167" width="100%" height="300" frameborder="0" style="border:0" allowfullscreen></iframe>
        <div class="line_break"></div>    
    </div>
    <div id="page_body"></div>
    <div id="contact_form" class="hidden_now">
        <form id="msg-contact" accept-charset="UTF-8" action="http://mobilefringe.createsend.com/t/d/s/tuktjk/"  enctype="multipart/form-data"  method="post">
            <input id="cm-name" type="hidden" name="cm-name" />
            <div class="row-fluid">
                <div class="col-md-6">
                    <label for="cm-firstname">First Name*</label>
                   <input class="contact-inputs" id="cm-firstname" name="cm-firstname" type="text" required/>
                </div>
                <div class="col-md-6">                
                   <label for="cm-lastname">Last Name*</label>
                    <input class="contact-inputs" id="cm-lastname" name="cm-lastname" type="text" required/>
                </div>
            </div>
            <div class="row-fluid">
                <div class="col-md-6">
                    <label for="email-newsletter">Email*</label>
                    <input class="contact-inputs" id="email-newsletter" name="cm-tuktjk-tuktjk" type="email" required />
                </div>
                <div class="col-md-6">
                   <label for="phoneNumber">Phone Number*</label>
                   <input class="contact-inputs" id="phoneNumber" name="cm-f-jyjkht" type="text" required/>
                </div>
            </div>
            <div class="row-fluid">
                <div class="col-md-10">
                    <label for="message">Message*</label>
                    <textarea id="message" name="cm-f-jyjkhi"></textarea>
                </div>
            </div>
            <div class="row-fluid">
                <div class="g-recaptcha" data-sitekey="6LduhgITAAAAAOuswnYWavEr1XmVyd-L4iAz-ElA"></div>
                <div id="captcha_validation" style="color:red; margin-top:10px; margin-bottom:10px; font-weight:bold; display:none">
                   Captcha is not valid!
                </div>    
            </div>
            <div class="row-fluid">
                <input class="btn btn-success " name="commit" onclick="submitMSG()" value="Submit" style="width:325px; height: 45px;" />    
            </div>
            
            
            <div class="line_break"></div>
            <!-- Captcha END -->
        </form>
    </div>
</div>
<div class="mobile_line_break"></div>

<script>
    $(document).ready(function(){
        function renderAll(){
            init();
            var pathArray = window.location.pathname.split( '/' );
            var slug = pathArray[pathArray.length-1];
            var pages_json = "//www.westbrookmall.com//pages/" + slug + ".json"
            $.getJSON(pages_json).done(function(data) {
                $('#page_title').html(data.title);
                $('#page_body').html(data.body);
                if(slug === "westbrook-contact-us") {
                    $("#contact_us").show();
                    $("#contact_form").show();
                }
                if(slug === "westbrook-accessability") {
                    $("#page_title").html("Accessibility");
                }
            }).fail(function(jqXHR) {
                if (jqXHR.status == 404) {
                    $("#error_msg").fadeIn("fast");
                }
            }); 
        }
        
        function submitMSG(){
            if ($("#cm-firstname").val() == ""){
                alert("Please Enter First Name");
                $("#cm-firstname").focus();
                return false;
            } else if ($("#cm-lastname").val() == ""){
                alert("Please Enter Last Name");
                $("#cm-lastname").focus();
                return false;
            } else if ($("#email-newsletter").val() == ""){
                alert("Please Enter Email");
                $("#email-newsletter").focus();
                return false;
            } else if(!isValidEmailAddress($("#email-newsletter").val())){
                alert("Please Enter a valid email address");
                $("#email-newsletter").focus();
                return false;
            } else if ($("#phoneNumber").val() == ""){
                alert("Please Enter Phone Number");
                $("#phoneNumber").focus();
                return false;
            } else if ($("#message").val() == ""){
                alert("Please Enter message");
                $("#message").focus();
                return false;
            }

            $('#cm-name').val($('#cm-firstname').val()+ ' ' +$('#cm-lastname').val());
            var values = {};
             $.each($('#msg-contact').serializeArray(), function(i, field) {
                 values[field.name] = field.value;
             });
            
            $.ajax({
                url : "/verify_captcha",
                type: "POST",
                data : {
                    "g-recaptcha-response": values['g-recaptcha-response'],
                    "secret_key": "6LduhgITAAAAANNWQjvEjqsi_cC0CrfNaqsg7e3u"
                },
                success: function(data, textStatus, jqXHR)
                {
                    if(data == "true"){
                        $.post( "/send_contact_email", { 'send_to': "westbrookmallinfo@20vic.com", 'subject': "Customer Feedback - Westbrook Mall", 'body': {"Name": $('#cm-name').val(), "Email" : $('#email-newsletter').val(), "Phone Number":$('#phoneNumber').val(),"Message":$('#message').val()} } );
                        $("#msg-contact").submit();
                    } else{
                        $('#captcha_validation').show();
                    }
                  
                },
                error: function (jqXHR, textStatus, errorThrown)
                {
                }
            });
        }
        loadMallDataCached(renderAll); 
    })
</script>